/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */
!function(undefined){"use strict";var hasOwnProperty=Object.hasOwnProperty,isArray=Array.isArray?Array.isArray:function _isArray(obj){return Object.prototype.toString.call(obj)==="[object Array]"},defaultMaxListeners=10;function init(){this._events={};if(this._conf){configure.call(this,this._conf)}}function configure(conf){if(conf){this._conf=conf;conf.delimiter&&(this.delimiter=conf.delimiter);this._maxListeners=conf.maxListeners!==undefined?conf.maxListeners:defaultMaxListeners;conf.wildcard&&(this.wildcard=conf.wildcard);conf.newListener&&(this._newListener=conf.newListener);if(this.wildcard){this.listenerTree={}}}else{this._maxListeners=defaultMaxListeners}}function logPossibleMemoryLeak(count,eventName){console.error("(node) warning: possible EventEmitter memory leak detected. "+count+" listeners added. Use emitter.setMaxListeners() to increase limit.");console.trace()}function EventEmitter(conf){this._events={};this.newListener=false;this.verboseMemoryLeak=false;configure.call(this,conf)}EventEmitter.EventEmitter2=EventEmitter;EventEmitter.prototype.delimiter=".";EventEmitter.prototype.setMaxListeners=function(n){if(n!==undefined){this._maxListeners=n;if(!this._conf)this._conf={};this._conf.maxListeners=n}};EventEmitter.prototype.event="";EventEmitter.prototype.once=function(event,fn){return this.many(event,1,fn)};EventEmitter.prototype.many=function(event,ttl,fn){var self=this;if(typeof fn!=="function"){throw new Error("many only accepts instances of Function")}function listener(){if(--ttl===0){self.off(event,listener)}return fn.apply(this,arguments)}listener._origin=fn;this.on(event,listener);return self};EventEmitter.prototype.emit=function(){this._events||init.call(this);var type=arguments[0];if(type==="newListener"&&!this.newListener){if(!this._events.newListener){return false}}var al=arguments.length;var args,l,i,j;var handler;if(this._all&&this._all.length){handler=this._all.slice();if(al>3){args=new Array(al);for(j=0;j<al;j++)args[j]=arguments[j]}for(i=0,l=handler.length;i<l;i++){this.event=type;switch(al){case 1:handler[i].call(this,type);break;case 2:handler[i].call(this,type,arguments[1]);break;case 3:handler[i].call(this,type,arguments[1],arguments[2]);break;default:handler[i].apply(this,args)}}}if(this.wildcard){handler=[];var ns=typeof type==="string"?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else{handler=this._events[type];if(typeof handler==="function"){this.event=type;switch(al){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=new Array(al-1);for(j=1;j<al;j++)args[j-1]=arguments[j];handler.apply(this,args)}return true}else if(handler){handler=handler.slice();if(al>3){args=new Array(al-1);for(j=1;j<al;j++)args[j-1]=arguments[j]}for(i=0,l=handler.length;i<l;i++){this.event=type;switch(al){case 1:handler[i].call(this);break;case 2:handler[i].call(this,arguments[1]);break;case 3:handler[i].call(this,arguments[1],arguments[2]);break;default:handler[i].apply(this,args)}}return true}}return!!this._all};EventEmitter.prototype.on=function(type,listener){if(typeof type==="function"){this.onAny(type);return this}if(typeof listener!=="function"){throw new Error("on only accepts instances of Function")}this._events||init.call(this);this.emit("newListener",type,listener);if(this.wildcard){growListenerTree.call(this,type,listener);return this}if(!this._events[type]){this._events[type]=listener}else{if(typeof this._events[type]==="function"){this._events[type]=[this._events[type],listener]}else{this._events[type].push(listener)}if(!this._events[type].warned&&this._maxListeners>0&&this._events[type].length>this._maxListeners){this._events[type].warned=true;logPossibleMemoryLeak(this._events[type].length,type)}}return this};EventEmitter.prototype.onAny=function(fn){if(typeof fn!=="function"){throw new Error("onAny only accepts instances of Function")}if(!this._all){this._all=[]}this._all.push(fn);return this};EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.off=function(type,listener){if(typeof listener!=="function"){throw new Error("removeListener only takes instances of Function")}var handlers,leafs=[];if(this.wildcard){var ns=typeof type==="string"?type.split(this.delimiter):type.slice();leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)}else{if(!this._events[type])return this;handlers=this._events[type];leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];handlers=leaf._listeners;if(isArray(handlers)){var position=-1;for(var i=0,length=handlers.length;i<length;i++){if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}}if(position<0){continue}if(this.wildcard){leaf._listeners.splice(position,1)}else{this._events[type].splice(position,1)}if(handlers.length===0){if(this.wildcard){delete leaf._listeners}else{delete this._events[type]}}if(this._removeListener)this.emit("removeListener",type,listener)}else if(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener){if(this.wildcard){delete leaf._listeners}else{delete this._events[type]}if(this._removeListener)this.emit("removeListener",type,listener)}}function recursivelyGarbageCollect(root){if(root===undefined){return}var keys=Object.keys(root);for(var i in keys){var key=keys[i];var obj=root[key];if(obj instanceof Function||typeof obj!=="object"||obj===null)continue;if(Object.keys(obj).length>0){recursivelyGarbageCollect(root[key])}else{delete root[key]}}return}recursivelyGarbageCollect(this.listenerTree);return this};EventEmitter.prototype.offAny=function(fn){var i=0,l=0,fns;if(fn&&this._all&&this._all.length>0){fns=this._all;for(i=0,l=fns.length;i<l;i++){if(fn===fns[i]){fns.splice(i,1);if(this._removeListener)this.emit("removeListener",undefined,fn);return this}}}else{fns=this._all;if(this._removeListener){for(i=0,l=fns.length;i<l;i++)this.emit("removeListener",undefined,fns[i])}this._all=[]}return this};EventEmitter.prototype.removeListener=EventEmitter.prototype.off;EventEmitter.prototype.removeAllListeners=function(type){if(type===undefined){this._events=new Function;this.listenerTree=new Object;return this}if(this.wildcard){var ns=typeof type==="string"?type.split(this.delimiter):type.slice();var leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0);for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];leaf._listeners=null}}else if(this._events){this._events[type]=null}return this};EventEmitter.prototype.listeners=function(type){if(this.wildcard){var handlers=[];var ns=typeof type==="string"?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handlers,ns,this.listenerTree,0);return handlers}this._events||init.call(this);if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type])){this._events[type]=[this._events[type]]}return this._events[type]};EventEmitter.prototype.listenerCount=function(type){return this.listeners(type).length};EventEmitter.prototype.listenersAny=function(){if(this._all){return this._all}else{return[]}};if(typeof define==="function"&&define.amd){define(function(){return EventEmitter})}else if(typeof exports==="object"){exports.EventEmitter2=EventEmitter}else{window.EventEmitter2=EventEmitter}}();
